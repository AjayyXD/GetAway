import mysql.connector
from mysql.connector import Error
import bcrypt
import getpass
import os
import time

DB_config={
    "host":"localhost",
    "user":"Ajay",
    "password":"123",
    "database":"GetAway"
}

def clear_screen():
    if os.name == "nt" :
        os.system("cls")
    else :
        os.system("clear")

def get_connection():
    try:
        connection = mysql.connector.connect(**DB_config)
        if connection:
            return connection
    except Error as e:
        print(f"Couldnt Connect to the Database, {e} ")
        return None
    
def add_student(connection):
    try:
        ID = input("Enter ID : ").strip()
        name = input("Enter Name : ")
        email = input("Enter Email : ").strip()
        fa = input("Enter FA ID : ").strip()
        warden = input("Enter Warden ID : ").strip()
        password = getpass.getpass("Enter Password : ").strip()
        repeat_password = getpass.getpass("Renter Password : ").strip()

        password_bytes = password.encode('utf-8')
        salt = bcrypt.gensalt()
        hashed_password = bcrypt.hashpw(password_bytes,salt)
        
        cursor = connection.cursor()
        query = "INSERT INTO Student (student_id,password_hash,name,email,fa_id,warden_id) VALUES (%s,%s,%s,%s,%s,%s);"

        cursor.execute(query,(ID,hashed_password,name,email,fa,warden))
        connection.commit()

        print(f"Added {ID} Successfully")
        input("Press any key to continue")
    except Error as e:
        print(f"Failed to add student, {e}")
    finally:
        if 'cursor' in locals():
            cursor.close()

def add_management(connection,role) : 
    try : 
        ID = input("Enter ID : ").strip()
        name = input("Enter Name : ")
        email = input("Enter Email : ").strip()
        password = getpass.getpass("Enter Password : ").strip()
        repeat_password = getpass.getpass("Renter Password : ").strip()

        password_bytes = password.encode('utf-8')
        salt = bcrypt.gensalt()
        hashed_password = bcrypt.hashpw(password_bytes,salt)
        cursor = connection.cursor()
        query = f"INSERT INTO {role} (id,name,email,password_hash) VALUES (%s,%s,%s,%s);"
        cursor.execute(query,(ID,name,email,hashed_password))

        connection.commit()
        print(f"Added {ID} Successfully")
        tmp = input("Press any key to continue")
    except Error as e :
        print(f"Failed to Add,{e}")
        tmp = input("Press any key to continue")
    finally : 
        if 'cursor' in locals() : 
            cursor.close()
    

def main():
    connection = get_connection()
    while True :
        clear_screen()
        print("----------Insert Users for GetAway-----------")
        print("1. Insert Student ")
        print("2. Insert Management ")
        print("Any other key to exit ")
        option = input("Selected option :")

        if option == "1" :
            add_student(connection)
            continue
        elif option == "2" :
            try : 
                roles = ["FA","Warden","Admin"]
                print("Select Role : 1. Faculty Advisor, 2. Hostel Warden, 3. Administration")
                role_choice = int(input ("Selected Option : "))
                role = roles[role_choice-1]
                add_management(connection,role)
                continue
            except Exception as e :
                print("Some Error Occured, {e}")
                input("Press any key to restart")
                continue
        else : 
            print("Script Terminated")
            return



if __name__ =='__main__':
    main()
    

